<template>
    <div class={containerClass}>
        <div class="customer-name-section">
            <div class="customer-info">
                <lightning-icon icon-name="utility:aggregate" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                    <a href="/lightning/r/Contact/003Wt00000OQTWpIAP/view"
                    target="_blank"
                    class="customer-name">
                    Sanjna Parulekar | Inbound | +180885...
                    </a>           
                 </div>
         
            <div class="window-controls">
            <button class="window-control"
                    onclick={handleChevronClick}
                    title="Minimize or Shrink">
                <template if:true={isShrunk}>
                <lightning-icon icon-name="utility:chevronup"
                                size="x-small"
                                alternative-text="Expand"></lightning-icon>
                </template>
                <template if:false={isShrunk}>
                <lightning-icon icon-name="utility:chevrondown"
                                size="x-small"
                                alternative-text="Shrink"></lightning-icon>
                </template>
            </button>
            </div>
   
        </div>
 

        <div class="buttons-section">
            <button class="action-button">
                <lightning-icon icon-name="utility:change_owner" alternative-text="Transfer to Rep" size="x-small"></lightning-icon>
                Transfer to Rep
            </button>
            <button class="action-button">
                <lightning-icon icon-name="utility:lower_flag" alternative-text="Lower Flag" size="x-small"></lightning-icon>
                Lower
            </button>
        </div>

         <div class="conversation-content">
            <template for:each={displayedEvents} for:item="event">
                <div key={event.id}>
                    <template if:true={event.isEventCenter}>
                        <div class="conversation-event center-aligned" data-call-ended={event.isCallEnded}>

                            <lightning-icon icon-name="utility:chat" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                            {event.content}
                        </div>
                    </template>
                    <template if:true={event.isEventCenterTopBorder}>
                        <div class="conversation-event center-aligned top-border" data-call-ended={event.isCallEnded}>
                            <lightning-icon icon-name="utility:chat" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                            {event.content}
                        </div>
                    </template>                   
                    <template if:true={event.isEventCenterNoBorder}>
                        <div class="conversation-event center-aligned no-border" data-call-ended={event.isCallEnded}>
                            <lightning-icon icon-name="utility:change_owner" size="x-small" class="slds-m-right_x-small"></lightning-icon>                            
                            {event.content}
                        </div>
                    </template>
                    <template if:true={event.isAgentMessage}>
                        <div class="message-bubble">
                            <div class="agent-message">{event.content}</div>
                            <div class="message-metadata agent-metadata">{event.timestamp}</div>
                        </div>
                    </template>
                    <template if:true={event.isCustomerMessage}>
                        <div class="message-bubble">
                            <div class="customer-message">{event.content}</div>
                            <div class="message-metadata customer-metadata">
                                <a href="#" class="phone-number" onclick={handlePhoneClick}>{customerPhone}</a> â€¢ {event.time}
                            </div>
                        </div>
                    </template>
                </div>
            </template>

            <!-- ADD THIS: bottom anchor -->
            <div data-id="bottom-anchor" style="height:1px;"></div>
        </div>
    </div>
</template>