<template>
    <!-- Idle State -->
    <template if:true={isIdle}>
        <div class="slds-box">
            <div class="slds-text-align_center slds-m-bottom_medium">
                <div class="slds-avatar slds-avatar_large slds-m-bottom_small">
                    <lightning-icon icon-name="standard:call" size="large"></lightning-icon>
                </div>
                <h2 class="slds-text-heading_medium slds-m-bottom_x-small">Dialer Ready</h2>
                <p class="slds-text-color_weak">Enter a number or select a contact</p>
            </div>

            <div class="slds-text-align_center">
                <p class="slds-text-heading_small slds-m-bottom_medium">Call Now?</p>
                
                <div class="button-group">
                    <lightning-button 
                        variant="brand" 
                        label="Call Now" 
                        icon-name="utility:call"
                        onclick={handleCallNow}
                        class="slds-m-right_small call-button">
                    </lightning-button>
                    <lightning-button 
                        variant="neutral" 
                        label="Cancel" 
                        onclick={handleCancel}>
                    </lightning-button>
                </div>
            </div>
        </div>
    </template>

    <!-- Confirm Call State -->
    <template if:true={isConfirm}>
        <div class="slds-box">
            <div class="slds-text-align_center slds-m-bottom_medium">
                <div class="slds-avatar slds-avatar_large slds-m-bottom_small">
                    <lightning-icon icon-name="standard:contact" size="large"></lightning-icon>
                </div>
                <h2 class="slds-text-heading_medium slds-m-bottom_x-small">{contactName}</h2>
                <p class="slds-text-color_weak">{formattedPhone}</p>
            </div>

            <div class="slds-text-align_center">
                <p class="slds-text-heading_small slds-m-bottom_medium">Call {contactName} now?</p>
                
                <div class="button-group">
                    <lightning-button 
                        variant="brand" 
                        label="Call Now" 
                        icon-name="utility:call"
                        onclick={handleCallNow}
                        class="slds-m-right_small call-button">
                    </lightning-button>
                    <lightning-button 
                        variant="neutral" 
                        label="Cancel" 
                        onclick={handleCancel}>
                    </lightning-button>
                </div>
            </div>
        </div>
    </template>

    <!-- Active Call State -->
    <template if:true={isCalling}>
        <div class="slds-box calling-state">
            <div class="slds-text-align_center">
                <div class="slds-m-bottom_medium">
                    <div class="avatar-pulse slds-m-bottom_small">
                        <lightning-icon icon-name="standard:contact" size="large"></lightning-icon>
                    </div>
                    <h2 class="slds-text-heading_medium slds-m-bottom_x-small">{contactName}</h2>
                    <p class="slds-text-color_weak slds-m-bottom_small">{formattedPhone}</p>
                </div>

                <div class="call-timer slds-m-bottom_large">
                    <div class="timer-display">
                        <lightning-icon icon-name="utility:clock" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                        <span class="slds-text-heading_large">{formattedDuration}</span>
                    </div>
                    <p class="slds-text-color_success call-status">
                        <span class="pulse-dot"></span>
                        Call in progress
                    </p>
                </div>

                <lightning-button 
                    variant="destructive" 
                    label="End Call" 
                    icon-name="utility:end_call"
                    onclick={handleEndCall}
                    class="end-call-button">
                </lightning-button>
            </div>
        </div>
    </template>

    <!-- Call Notes State -->
    <template if:true={isNotes}>
        <div class="slds-box">
            <div class="slds-m-bottom_medium">
                <div class="slds-media slds-media_center">
                    <div class="slds-media__figure">
                        <lightning-icon icon-name="utility:success" size="small" variant="success"></lightning-icon>
                    </div>
                    <div class="slds-media__body">
                        <h2 class="slds-text-heading_small">Call Completed</h2>
                        <p class="slds-text-color_weak">Duration: {formattedDuration}</p>
                    </div>
                </div>
            </div>

            <div class="slds-form-element slds-m-bottom_medium">
                <label class="slds-form-element__label" for="call-notes">
                    <abbr class="slds-required" title="required">* </abbr>Call Notes
                </label>
                <div class="slds-form-element__control">
                    <lightning-textarea 
                        id="call-notes"
                        placeholder="Enter notes about this call..."
                        value={callNotes}
                        onchange={handleNotesChange}
                        rows="6">
                    </lightning-textarea>
                </div>
            </div>

            <div class="slds-text-align_right">
                <lightning-button 
                    variant="neutral" 
                    label="Discard" 
                    onclick={handleCancelNotes}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button 
                    variant="brand" 
                    label="Save Call Log" 
                    icon-name="utility:save"
                    onclick={handleSaveCall}>
                </lightning-button>
            </div>
        </div>
    </template>

    <!-- Call Completed State with Dial Pad -->
<template if:true={isCompleted}>
    <div class="slds-box" style="padding: 0.75rem;">
        <!-- Phone Screen Look -->
        <div class="phone-screen">
            <!-- Contact Info Header - Compact -->
            <div class="slds-text-align_center slds-m-bottom_small">
                <div class="slds-avatar slds-avatar_medium slds-m-bottom_x-small" style="margin: 0 auto;">
                    <lightning-icon icon-name="standard:contact" size="medium"></lightning-icon>
                </div>
                <h3 class="slds-text-heading_small" style="margin-bottom: 0.25rem;">{contactName}</h3>
                <p class="slds-text-color_weak" style="font-size: 11px; margin-bottom: 0.5rem;">{formattedPhone}</p>
                <div class="call-success-badge">
                    <lightning-icon icon-name="utility:success" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                    Call Logged
                </div>
            </div>

            <!-- Dial Pad -->
            <div class="dial-pad-container">
                <div class="dial-pad">
                    <div class="dial-row">
                        <div class="dial-key">1<span class="dial-letters">• • •</span></div>
                        <div class="dial-key">2<span class="dial-letters">ABC</span></div>
                        <div class="dial-key">3<span class="dial-letters">DEF</span></div>
                    </div>
                    <div class="dial-row">
                        <div class="dial-key">4<span class="dial-letters">GHI</span></div>
                        <div class="dial-key">5<span class="dial-letters">JKL</span></div>
                        <div class="dial-key">6<span class="dial-letters">MNO</span></div>
                    </div>
                    <div class="dial-row">
                        <div class="dial-key">7<span class="dial-letters">PQRS</span></div>
                        <div class="dial-key">8<span class="dial-letters">TUV</span></div>
                        <div class="dial-key">9<span class="dial-letters">WXYZ</span></div>
                    </div>
                    <div class="dial-row">
                        <div class="dial-key">*</div>
                        <div class="dial-key dial-key-zero">0<span class="dial-letters">+</span></div>
                        <div class="dial-key">#</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons - Compact -->
        <div class="slds-text-align_center" style="margin-top: 0.75rem;">
            <lightning-button 
                variant="brand" 
                label="Call Again" 
                icon-name="utility:call"
                onclick={handleCallAgain}
                class="slds-m-right_small">
            </lightning-button>
            <lightning-button 
                variant="neutral" 
                label="Close" 
                onclick={handleClose}>
            </lightning-button>
        </div>
    </div>
</template>